#!/system/bin/sh

# SPDX-FileCopyrightText: 2017-2021 The LineageOS Project
# SPDX-License-Identifier: Apache-2.0

# Release keys
platform_key_release="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAvIbyolq8mcAlsSl3vRIFGt8YxMGLehsVQUCRLVvm6Cwx0Nz8n4k7l0kvhgHM/UM3EN5NdNKzYfekkIifk5xuC1gxbAEThnqZqwwf0LtRyNjmzXi9tGPPwAx//6lQFDGdGnoXmVQ5WpANht8NIiMmeruK6Eleppt1WAoGaOolX6Ofk41qHjFLH+vrpc7Fpv8DB0hngSZub6r61N3MkpjID6FRsoD0Uw7m/bNH2ui897/Ax36wH5w75sAvQ52o0vKXM87NyBX3EVkGSP68Mfe8VyfNSp1/22EMi2MxlKtxFSsNQGc3MyS8y5lB4PCzjnNwpAazo7RE58MRbzLWPXx/bwIDAQAB"
platform_cert_release="3082041b30820303a0030201020214493d6527aa720810f7f9baece009d0acc49b97c7300d06092a864886f70d01010b050030819b310b300906035504061302494e3112301006035504080c094a6861726b68616e64310f300d06035504070c06426f6b61726f31143012060355040a0c0b696e6665726e6f3032333031143012060355040b0c0b696e6665726e6f303233303117301506035504030c0e696e6665726e6f303233302e696e3122302006092a864886f70d01090116136d61696c40696e6665726e6f303233302e696e3020170d3234303532353136353731385a180f32303531313031313136353731385a30819b310b300906035504061302494e3112301006035504080c094a6861726b68616e64310f300d06035504070c06426f6b61726f31143012060355040a0c0b696e6665726e6f3032333031143012060355040b0c0b696e6665726e6f303233303117301506035504030c0e696e6665726e6f303233302e696e3122302006092a864886f70d01090116136d61696c40696e6665726e6f303233302e696e30820122300d06092a864886f70d01010105000382010f003082010a0282010100bc86f2a25abc99c025b12977bd12051adf18c4c18b7a1b154140912d5be6e82c31d0dcfc9f893b97492f8601ccfd433710de4d74d2b361f7a490889f939c6e0b58316c0113867a99ab0c1fd0bb51c8d8e6cd78bdb463cfc00c7fffa95014319d1a7a179954395a900d86df0d2223267abb8ae8495ea69b75580a0668ea255fa39f938d6a1e314b1febeba5cec5a6ff0307486781266e6faafad4ddcc9298c80fa151b280f4530ee6fdb347dae8bcf7bfc0c77eb01f9c3be6c02f439da8d2f29733cecdc815f711590648febc31f7bc5727cd4a9d7fdb610c8b633194ab71152b0d4067373324bccb9941e0f0b38e7370a406b3a3b444e7c3116f32d63d7c7f6f0203010001a3533051301d0603551d0e04160414b3de888e5aa24d6a2e16b25423cdb291e97d4ba0301f0603551d23041830168014b3de888e5aa24d6a2e16b25423cdb291e97d4ba0300f0603551d130101ff040530030101ff300d06092a864886f70d01010b0500038201010019888451d01ceecac2cf936561cbf07b23992673cbba15c34e583f0bb1fff78e7fbdb100e2b9405045c741e1d0a082ed72056724a83ba8107ff343221713dc4aa33e7d9fda2631d427400fe4d83c1479e11a9de7e3c8257220ac034ebeb017a8ad75ca8d53b4f54c99474ffaf8a0dd0541bfbbe68914dd739c53850cf2b6cbc9cd20a436ee04b3ba1dd83ef99f4777479db977f2a705d320d9f728a9bcf70f06dd77c18fd27e7463050dd648e77c50209816a20e6cbecfd2aafdd985aa1de10bfcd68ed508b10050873652420e1026f22a0c7a35896f562289753205c9b67a5028ef6d251b098bfd1a7139952251bdd46c6463c9a0f893ec9855beb3ff5116c6"
media_key_release="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAmfpMp3NzT9dRHGbLlJbDsmIv6T0wjMfnGLLFdPdzlm3iT+AvTdtAKZkNnuRw3Zr3KZo3fsKg+fDLQiLTyWAmjt/9qDxLFbqvHwYTzxtm6TYGI4OoKDo2KDmPrtnZtr4diOEsZQf7Pb90hDPgCgpH0IZqpuwcpSe+vf34vUU2onjeg5DicGzS+mluQGYb8DVy5V+fUwaQc/BBPfSXuJf8CJhSLnLRx0YVCbJmzeUPhABiD2xMsGgywoaW9PWEzIisJdF0MzK4q/KfdKJmVj+zGz5p0yAkoEjlcn/ZIPqxcnJ+2tjhIyZfD5QFG4ZvcjNYPMxfuXre2Zvo2N6q6W789QIDAQAB"
media_cert_release="3082041b30820303a003020102021453a273bb63cbd4eb1126164df41854d377aeda15300d06092a864886f70d01010b050030819b310b300906035504061302494e3112301006035504080c094a6861726b68616e64310f300d06035504070c06426f6b61726f31143012060355040a0c0b696e6665726e6f3032333031143012060355040b0c0b696e6665726e6f303233303117301506035504030c0e696e6665726e6f303233302e696e3122302006092a864886f70d01090116136d61696c40696e6665726e6f303233302e696e3020170d3234303532353136353731385a180f32303531313031313136353731385a30819b310b300906035504061302494e3112301006035504080c094a6861726b68616e64310f300d06035504070c06426f6b61726f31143012060355040a0c0b696e6665726e6f3032333031143012060355040b0c0b696e6665726e6f303233303117301506035504030c0e696e6665726e6f303233302e696e3122302006092a864886f70d01090116136d61696c40696e6665726e6f303233302e696e30820122300d06092a864886f70d01010105000382010f003082010a028201010099fa4ca773734fd7511c66cb9496c3b2622fe93d308cc7e718b2c574f773966de24fe02f4ddb4029990d9ee470dd9af7299a377ec2a0f9f0cb4222d3c960268edffda83c4b15baaf1f0613cf1b66e936062383a8283a3628398faed9d9b6be1d88e12c6507fb3dbf748433e00a0a47d0866aa6ec1ca527bebdfdf8bd4536a278de8390e2706cd2fa696e40661bf03572e55f9f53069073f0413df497b897fc0898522e72d1c7461509b266cde50f8400620f6c4cb06832c28696f4f584cc88ac25d1743332b8abf29f74a266563fb31b3e69d32024a048e5727fd920fab172727edad8e123265f0f94051b866f7233583ccc5fb97aded99be8d8deaae96efcf50203010001a3533051301d0603551d0e04160414e4805c2df768ba558cafa88e1d85e7e0bba2dfa8301f0603551d23041830168014e4805c2df768ba558cafa88e1d85e7e0bba2dfa8300f0603551d130101ff040530030101ff300d06092a864886f70d01010b050003820101001e39ad14b64dc02f02bb7b9ed98689cb218b5224cf4045693e727d0d40ea17d7f7a94d7ec04e24e7ded3748b92d2135c93e70896c56641a824cd9831f3a5319f7870d2e12e238671af7e114168bbd603832e8ae81a9176e5d807890925c4e9fa68a6a4e59e51b6edf24e30a9142fc70c575f63a95a23831a1b60f8ca1086d87516c666f674a67095a7459e6ba39ae2ea76f63a87291888fc48b0c70971dd4342037c5d32f0f7db8489670b5e8cff30330108e16d953a71d8f85dd9ebc00098d2afa4043e725aacccdc1c8d5874b19b0280c0a61e9d138fc847751b03b451ecc44f7014568ebfed99e15e34835bb03307377db47ad9e9225f21564608977c128f"
shared_key_release="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqQwBP4yBpN93NO7LCnkcmIriIfm/+Gfjn6Ev1h8ihw91+jZu+zsUovj9rVjIUZMZsS3l/Z6zgmUAOgv8B0TvilZYfLJfD5knZRo/o46Vj16zf34rdGHnT4HMPy7w7oYxrQXiiE3oanfc6a/7hVT9HyYD7Lz7qhe8y3KtMNAUNJ/jXQ/4ySOg36C+FdJ9Nf1ueHRv1CpNNvMzwtED0aPD1HgIs5WaUSZlj4kAFFDbwnzm4RGn7nob1YoEGSsg7tVn5rOs9gGvow40lCenMpI8fPLhNVt9Luh341wCVERA9XvvE9UItPDedVgvZwtH9e23Flmj0Dk8wlDsPWLZjVNLiwIDAQAB"
shared_cert_release="3082041b30820303a003020102021403fa857000ff9e0931c88d4b708d70e5938c8147300d06092a864886f70d01010b050030819b310b300906035504061302494e3112301006035504080c094a6861726b68616e64310f300d06035504070c06426f6b61726f31143012060355040a0c0b696e6665726e6f3032333031143012060355040b0c0b696e6665726e6f303233303117301506035504030c0e696e6665726e6f303233302e696e3122302006092a864886f70d01090116136d61696c40696e6665726e6f303233302e696e3020170d3234303532353136353731385a180f32303531313031313136353731385a30819b310b300906035504061302494e3112301006035504080c094a6861726b68616e64310f300d06035504070c06426f6b61726f31143012060355040a0c0b696e6665726e6f3032333031143012060355040b0c0b696e6665726e6f303233303117301506035504030c0e696e6665726e6f303233302e696e3122302006092a864886f70d01090116136d61696c40696e6665726e6f303233302e696e30820122300d06092a864886f70d01010105000382010f003082010a0282010100a90c013f8c81a4df7734eecb0a791c988ae221f9bff867e39fa12fd61f22870f75fa366efb3b14a2f8fdad58c8519319b12de5fd9eb38265003a0bfc0744ef8a56587cb25f0f9927651a3fa38e958f5eb37f7e2b7461e74f81cc3f2ef0ee8631ad05e2884de86a77dce9affb8554fd1f2603ecbcfbaa17bccb72ad30d014349fe35d0ff8c923a0dfa0be15d27d35fd6e78746fd42a4d36f333c2d103d1a3c3d47808b3959a5126658f89001450dbc27ce6e111a7ee7a1bd58a04192b20eed567e6b3acf601afa30e349427a732923c7cf2e1355b7d2ee877e35c02544440f57bef13d508b4f0de75582f670b47f5edb71659a3d0393cc250ec3d62d98d534b8b0203010001a3533051301d0603551d0e041604148fb4c01b89f8b348599a7122adc0a6c6792c899e301f0603551d230418301680148fb4c01b89f8b348599a7122adc0a6c6792c899e300f0603551d130101ff040530030101ff300d06092a864886f70d01010b050003820101002f3e4224c47f20f7019a8ea2fdfdceb9fa681c5eb44032a01df4e32cc58294d134a971cae0e0fd678e46f83f77de1ea451bd2a23332a5bbb0330aa77eec1aa4761f13dd055326c4fef7f8ef6980db44c00777ed44a8de5e0c72394464c3b65349aab610ac20af5495908fcc314d1c03ed2fff9ec35d9e96e484970ff9417a1878e2acc35588210cc0dddd702ad380f27bc43af1f0e2619f0a74f26f0f8ede69603eb46971950cab9b507606e1d790b858ad2950d52f8a556f360d117daeece9d42a4fd6f9e5201a58fb962b5408198ac28e0e6dd45bc6642689fc59d2a47b258180ebe282f6082a13df2e4538e6857af7ecf5470624184268b3e9416dda6f960"
release_key="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAt7CjCalQ7SknJELGAemoNKOa9V3UV2ITR5E3t+blE5vnI0jtmvtndWF35Py06wIq5Mt9UHWjz9ycyeM9x1EmSaUmyttj5/8eD3uefvT5CKyQkc2x01EHym5DIkR5txQE4fROPRCFlMBsokmNjqpZpu0AUxMM8OYRuNgFrifpQOqaFBRsY5QIVg/bQ5SvFX7nh2AZCXhlL3oWaj7LyujPblD5l+DREWRZ6fHL534jqQnrY3D5fLQfaceQAk5cPJCTguIqdne4QDAJelwiuGvMkI5ollg9zjbYtUO6rH7oYTN5xmy8M0yEICXc1uEN/Gk4FNjwyphGrR1YgrWTEW9DDwIDAQAB"
release_cert="3082041b30820303a00302010202144f7689ff6a9daa8e362fa96ca3e4e91782616ff0300d06092a864886f70d01010b050030819b310b300906035504061302494e3112301006035504080c094a6861726b68616e64310f300d06035504070c06426f6b61726f31143012060355040a0c0b696e6665726e6f3032333031143012060355040b0c0b696e6665726e6f303233303117301506035504030c0e696e6665726e6f303233302e696e3122302006092a864886f70d01090116136d61696c40696e6665726e6f303233302e696e3020170d3234303532353136353731385a180f32303531313031313136353731385a30819b310b300906035504061302494e3112301006035504080c094a6861726b68616e64310f300d06035504070c06426f6b61726f31143012060355040a0c0b696e6665726e6f3032333031143012060355040b0c0b696e6665726e6f303233303117301506035504030c0e696e6665726e6f303233302e696e3122302006092a864886f70d01090116136d61696c40696e6665726e6f303233302e696e30820122300d06092a864886f70d01010105000382010f003082010a0282010100b7b0a309a950ed29272442c601e9a834a39af55dd4576213479137b7e6e5139be72348ed9afb67756177e4fcb4eb022ae4cb7d5075a3cfdc9cc9e33dc7512649a526cadb63e7ff1e0f7b9e7ef4f908ac9091cdb1d35107ca6e43224479b71404e1f44e3d108594c06ca2498d8eaa59a6ed0053130cf0e611b8d805ae27e940ea9a14146c639408560fdb4394af157ee78760190978652f7a166a3ecbcae8cf6e50f997e0d1116459e9f1cbe77e23a909eb6370f97cb41f69c790024e5c3c909382e22a7677b84030097a5c22b86bcc908e6896583dce36d8b543baac7ee8613379c66cbc334c842025dcd6e10dfc693814d8f0ca9846ad1d5882b593116f430f0203010001a3533051301d0603551d0e04160414556abdef60689888987315764fb704da1684cf7f301f0603551d23041830168014556abdef60689888987315764fb704da1684cf7f300f0603551d130101ff040530030101ff300d06092a864886f70d01010b050003820101000cd68dd197c51c956125a37260e4be10a4d88b9d059adc953bbdc9de0bd2fa0266e7bb8f9fd62194862bf4aa30d66c9aa32cebc36992b655640444d05374436102951e493473ae5f6fbc2f1b2f8b9754ab6eb274465b62b0eaa8845fc76bede80b5a50c6651b8dd3e01d903201bbabf1f15b4081235f60d5c417c7ebe94ea790e622fb5707bbb526716eaa56082a14e7240cf4522cd560cf4e4969b6a2157f2b4d9ae4e7aabdcf117e30f31cc1222ae2502286cd3757dc4dff93feb4b4285457da6bedbb36fc140c0a817a80c98e0fdf90b205e7c50ea35b94cc7647f1a31225b9668b6e8e8310570cc72d06147ffed48a5801e59b056a08626821d5ff42b0be"

# Test keys
media_cert_test='308204a830820390a003020102020900f2b98e6123572c4e300d06092a864886f70d0101040500308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d301e170d3038303431353233343035375a170d3335303930313233343035375a308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d30820120300d06092a864886f70d01010105000382010d00308201080282010100ae250c5a16ef97fc2869ac651b3217cc36ba0e86964168d58a049f40ce85867123a3ffb4f6d949c33cf2da3a05c23eacaa57d803889b1759bcf59e7c6f21890ae25085b7ed56aa626c0989ef9ccd36362ca0e8d1b9603fd4d8328767926ccc090c68b775ae7ff30934cc369ef2855a2667df0c667fd0c7cf5d8eba655806737303bb624726eabaedfb72f07ed7a76ab3cb9a381c4b7dcd809b140d891f00213be401f58d6a06a61eadc3a9c2f1c6567285b09ae09342a66fa421eaf93adf7573a028c331d70601ab3af7cc84033ece7c772a3a5b86b0dbe9d777c3a48aa9801edcee2781589f44d9e4113979600576a99410ba81091259dad98c6c68ff784b8f020103a381fc3081f9301d0603551d0e04160414ca293caa8bc0ed3e542eef4205a2bff2b57e4d753081c90603551d230481c13081be8014ca293caa8bc0ed3e542eef4205a2bff2b57e4d75a1819aa48197308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d820900f2b98e6123572c4e300c0603551d13040530030101ff300d06092a864886f70d0101040500038201010084de9516d5e4a87217a73da8487048f53373a5f733f390d61bdf3cc9e5251625bfcaa7c3159cae275d172a9ae1e876d5458127ac542f68290dd510c0029d8f51e0ee156b7b7b5acdb394241b8ec78b74e5c42c5cafae156caf5bd199a23a27524da072debbe378464a533630b0e4d0ffb7e08ecb701fadb6379c74467f6e00c6ed888595380792038756007872c8e3007af423a57a2cab3a282869b64c4b7bd5fc187d0a7e2415965d5aae4e07a6df751b4a75e9793c918a612b81cd0b628aee0168dc44e47b10d3593260849d6adf6d727dc24444c221d3f9ecc368cad07999f2b8105bc1f20d38d41066cc1411c257a96ea4349f5746565507e4e8020a1a81'
media_key_test='MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEAriUMWhbvl/woaaxlGzIXzDa6DoaWQWjVigSfQM6FhnEjo/+09tlJwzzy2joFwj6sqlfYA4ibF1m89Z58byGJCuJQhbftVqpibAmJ75zNNjYsoOjRuWA/1Ngyh2eSbMwJDGi3da5/8wk0zDae8oVaJmffDGZ/0MfPXY66ZVgGc3MDu2JHJuq67fty8H7Xp2qzy5o4HEt9zYCbFA2JHwAhO+QB9Y1qBqYercOpwvHGVnKFsJrgk0Kmb6Qh6vk633VzoCjDMdcGAas698yEAz7OfHcqOluGsNvp13fDpIqpgB7c7ieBWJ9E2eQROXlgBXaplBC6gQkSWdrZjGxo/3hLjwIBAw=='
platform_cert_test='308204a830820390a003020102020900b3998086d056cffa300d06092a864886f70d0101040500308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d301e170d3038303431353232343035305a170d3335303930313232343035305a308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d30820120300d06092a864886f70d01010105000382010d003082010802820101009c780592ac0d5d381cdeaa65ecc8a6006e36480c6d7207b12011be50863aabe2b55d009adf7146d6f2202280c7cd4d7bdb26243b8a806c26b34b137523a49268224904dc01493e7c0acf1a05c874f69b037b60309d9074d24280e16bad2a8734361951eaf72a482d09b204b1875e12ac98c1aa773d6800b9eafde56d58bed8e8da16f9a360099c37a834a6dfedb7b6b44a049e07a269fccf2c5496f2cf36d64df90a3b8d8f34a3baab4cf53371ab27719b3ba58754ad0c53fc14e1db45d51e234fbbe93c9ba4edf9ce54261350ec535607bf69a2ff4aa07db5f7ea200d09a6c1b49e21402f89ed1190893aab5a9180f152e82f85a45753cf5fc19071c5eec827020103a381fc3081f9301d0603551d0e041604144fe4a0b3dd9cba29f71d7287c4e7c38f2086c2993081c90603551d230481c13081be80144fe4a0b3dd9cba29f71d7287c4e7c38f2086c299a1819aa48197308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d820900b3998086d056cffa300c0603551d13040530030101ff300d06092a864886f70d01010405000382010100572551b8d93a1f73de0f6d469f86dad6701400293c88a0cd7cd778b73dafcc197fab76e6212e56c1c761cfc42fd733de52c50ae08814cefc0a3b5a1a4346054d829f1d82b42b2048bf88b5d14929ef85f60edd12d72d55657e22e3e85d04c831d613d19938bb8982247fa321256ba12d1d6a8f92ea1db1c373317ba0c037f0d1aff645aef224979fba6e7a14bc025c71b98138cef3ddfc059617cf24845cf7b40d6382f7275ed738495ab6e5931b9421765c491b72fb68e080dbdb58c2029d347c8b328ce43ef6a8b15533edfbe989bd6a48dd4b202eda94c6ab8dd5b8399203daae2ed446232e4fe9bd961394c6300e5138e3cfd285e6e4e483538cb8b1b357'
platform_key_test='MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEAnHgFkqwNXTgc3qpl7MimAG42SAxtcgexIBG+UIY6q+K1XQCa33FG1vIgIoDHzU172yYkO4qAbCazSxN1I6SSaCJJBNwBST58Cs8aBch09psDe2AwnZB00kKA4WutKoc0NhlR6vcqSC0JsgSxh14SrJjBqnc9aAC56v3lbVi+2OjaFvmjYAmcN6g0pt/tt7a0SgSeB6Jp/M8sVJbyzzbWTfkKO42PNKO6q0z1M3GrJ3GbO6WHVK0MU/wU4dtF1R4jT7vpPJuk7fnOVCYTUOxTVge/aaL/SqB9tffqIA0JpsG0niFAL4ntEZCJOqtakYDxUugvhaRXU89fwZBxxe7IJwIBAw=='
shared_cert_test='308204a830820390a003020102020900f2a73396bd38767a300d06092a864886f70d0101040500308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d301e170d3038303732333231353735395a170d3335313230393231353735395a308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d30820120300d06092a864886f70d01010105000382010d00308201080282010100c8c2dbfd094a2df45c3ff1a32ed21805ec72fc58d017971bd0f6b52c262d70819d191967e158dfd3a2c7f1b3e0e80ce545d79d2848220211eb86f0fd8312d37b420c113750cc94618ae872f4886463bdc4627caa0c0483c86493e3515571170338bfdcc4cd6addd1c0a2f35f5cf24ed3e4043a3e58e2b05e664ccde12bcb67735fd6df1249c369e62542bc0a4729e53917f5c38ffa52d17b73c9c73798ddb18ed481590875547e66bfc5daca4c25a6eb960ed96923709da302ba646cb496b325e86c5c8b2e7a3377b2bbe4c7cf33254291163f689152ac088550c83c508f4bf5adf0aed5a2dca0583f9ab0ad17650db7eea4b23fdb45885547d0feab72183889020103a381fc3081f9301d0603551d0e04160414cb4c7e2cdbb3f0ada98dab79968d172e9dbb1ed13081c90603551d230481c13081be8014cb4c7e2cdbb3f0ada98dab79968d172e9dbb1ed1a1819aa48197308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d820900f2a73396bd38767a300c0603551d13040530030101ff300d06092a864886f70d0101040500038201010040a8d096997959e917a36c44246b6bac2bae05437ecd89794118f7834720352d1c6f8a39b0869942f4da65981faa2951d33971129ec1921d795671c527d6e249f252829faf5b591310311e2de096500d568ad4114a656dc34a8c6f610453afc1ea7992dba4aa7b3f8543a6e35c0728de77fe97eeac83771fd0ec90f8e4449434ee0b6045783e70c7a2e460249260e003cf7608dc352a4c9ef706def4b26050e978ae2fffd7a3323787014915eb3cc874fcc7a9ae930877c5c8c7d1c2e2a8ee863c89180d1855cedba400e7ba43cccaa7243d397e7c0e8e8e4d7d4f92b6bbead49c0cf018069eddca2e7e2fb4668d89dbbd7950d0cd254180fa1eaafc2a556f84'
shared_key_test='MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEAyMLb/QlKLfRcP/GjLtIYBexy/FjQF5cb0Pa1LCYtcIGdGRln4Vjf06LH8bPg6AzlRdedKEgiAhHrhvD9gxLTe0IMETdQzJRhiuhy9IhkY73EYnyqDASDyGST41FVcRcDOL/cxM1q3dHAovNfXPJO0+QEOj5Y4rBeZkzN4SvLZ3Nf1t8SScNp5iVCvApHKeU5F/XDj/pS0Xtzycc3mN2xjtSBWQh1VH5mv8XaykwlpuuWDtlpI3CdowK6ZGy0lrMl6Gxciy56M3eyu+THzzMlQpEWP2iRUqwIhVDIPFCPS/Wt8K7VotygWD+asK0XZQ237qSyP9tFiFVH0P6rchg4iQIBAw=='
test_cert='308204a830820390a003020102020900936eacbe07f201df300d06092a864886f70d0101050500308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d301e170d3038303232393031333334365a170d3335303731373031333334365a308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d30820120300d06092a864886f70d01010105000382010d00308201080282010100d6931904dec60b24b1edc762e0d9d8253e3ecd6ceb1de2ff068ca8e8bca8cd6bd3786ea70aa76ce60ebb0f993559ffd93e77a943e7e83d4b64b8e4fea2d3e656f1e267a81bbfb230b578c20443be4c7218b846f5211586f038a14e89c2be387f8ebecf8fcac3da1ee330c9ea93d0a7c3dc4af350220d50080732e0809717ee6a053359e6a694ec2cb3f284a0a466c87a94d83b31093a67372e2f6412c06e6d42f15818dffe0381cc0cd444da6cddc3b82458194801b32564134fbfde98c9287748dbf5676a540d8154c8bbca07b9e247553311c46b9af76fdeeccc8e69e7c8a2d08e782620943f99727d3c04fe72991d99df9bae38a0b2177fa31d5b6afee91f020103a381fc3081f9301d0603551d0e04160414485900563d272c46ae118605a47419ac09ca8c113081c90603551d230481c13081be8014485900563d272c46ae118605a47419ac09ca8c11a1819aa48197308194310b3009060355040613025553311330110603550408130a43616c69666f726e6961311630140603550407130d4d6f756e7461696e20566965773110300e060355040a1307416e64726f69643110300e060355040b1307416e64726f69643110300e06035504031307416e64726f69643122302006092a864886f70d0109011613616e64726f696440616e64726f69642e636f6d820900936eacbe07f201df300c0603551d13040530030101ff300d06092a864886f70d010105050003820101007aaf968ceb50c441055118d0daabaf015b8a765a27a715a2c2b44f221415ffdace03095abfa42df70708726c2069e5c36eddae0400be29452c084bc27eb6a17eac9dbe182c204eb15311f455d824b656dbe4dc2240912d7586fe88951d01a8feb5ae5a4260535df83431052422468c36e22c2a5ef994d61dd7306ae4c9f6951ba3c12f1d1914ddc61f1a62da2df827f603fea5603b2c540dbd7c019c36bab29a4271c117df523cdbc5f3817a49e0efa60cbd7f74177e7a4f193d43f4220772666e4c4d83e1bd5a86087cf34f2dec21e245ca6c2bb016e683638050d2c430eea7c26a1c49d3760a58ab7f1a82cc938b4831384324bd0401fa12163a50570e684d'
test_key='MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEA1pMZBN7GCySx7cdi4NnYJT4+zWzrHeL/Boyo6LyozWvTeG6nCqds5g67D5k1Wf/ZPnepQ+foPUtkuOT+otPmVvHiZ6gbv7IwtXjCBEO+THIYuEb1IRWG8DihTonCvjh/jr7Pj8rD2h7jMMnqk9Cnw9xK81AiDVAIBzLggJcX7moFM1nmppTsLLPyhKCkZsh6lNg7MQk6ZzcuL2QSwG5tQvFYGN/+A4HMDNRE2mzdw7gkWBlIAbMlZBNPv96YySh3SNv1Z2pUDYFUyLvKB7niR1UzEcRrmvdv3uzMjmnnyKLQjngmIJQ/mXJ9PAT+cpkdmd+brjigshd/ox1bav7pHwIBAw=='


PACKAGES=/data/system/packages.xml
PACKAGES_INTERMEDIATE=/data/local/tmp/packages.xml.decoded
PACKAGES_BACKUP=/data/system/packages-backup.xml
MODIFICATION_TARGET=$PACKAGES

ANDROID_VERSION=$(getprop ro.build.version.release)

[ $ANDROID_VERSION -ge 12 ] && USE_ABX=1

case "$1" in
    "official")
        to_official=true
        echo "Unofficial to official migration"
        ;;
    "unofficial")
        echo "Official to unofficial migration"
        ;;
    *)
        echo "USAGE: $0 official|unofficial"
        exit 1
        ;;
esac

if [ $USE_ABX ]; then
    abx2xml $PACKAGES $PACKAGES_INTERMEDIATE
    MODIFICATION_TARGET=$PACKAGES_INTERMEDIATE
fi

# If there's a "backup" copy, then the current packages.xml might
# be corrupted, so overwrite it with the backup copy. This is what
# PackageManager would do.
if [ -f $PACKAGES_BACKUP ]; then
    mv $PACKAGES_BACKUP $PACKAGES
    echo "Overwriting $PACKAGES with $PACKAGES_BACKUP"
fi

if [ ! -f $PACKAGES ]; then
    echo "Error: $PACKAGES not found"
    exit 1
fi

# Save a copy of the current file, not to be confused with
# packages-backup.xml, which is used and generated by Android
echo "Saving backup as $PACKAGES.bak"
cp $PACKAGES $PACKAGES.bak

if [ "$to_official" = "true" ]; then
    sed -i "s#$media_cert_test#$media_cert_release#g" $MODIFICATION_TARGET
    sed -i "s#$platform_cert_test#$platform_cert_release#g" $MODIFICATION_TARGET
    sed -i "s#$shared_cert_test#$shared_cert_release#g" $MODIFICATION_TARGET
    sed -i "s#$test_cert#$release_cert#g" $MODIFICATION_TARGET
    sed -i "s#$media_key_test#$media_key_release#g" $MODIFICATION_TARGET
    sed -i "s#$platform_key_test#$platform_key_release#g" $MODIFICATION_TARGET
    sed -i "s#$shared_key_test#$shared_key_release#g" $MODIFICATION_TARGET
    sed -i "s#$test_key#$release_key#g" $MODIFICATION_TARGET
else
    sed -i "s#$media_cert_release#$media_cert_test#g" $MODIFICATION_TARGET
    sed -i "s#$platform_cert_release#$platform_cert_test#g" $MODIFICATION_TARGET
    sed -i "s#$shared_cert_release#$shared_cert_test#g" $MODIFICATION_TARGET
    sed -i "s#$release_cert#$test_cert#g" $MODIFICATION_TARGET
    sed -i "s#$media_key_release#$media_key_test#g" $MODIFICATION_TARGET
    sed -i "s#$platform_key_release#$platform_key_test#g" $MODIFICATION_TARGET
    sed -i "s#$shared_key_release#$shared_key_test#g" $MODIFICATION_TARGET
    sed -i "s#$release_key#$test_key#g" $MODIFICATION_TARGET
fi

if [ $USE_ABX ]; then
    xml2abx $MODIFICATION_TARGET $PACKAGES
fi

chmod 660 $PACKAGES
chown system:system $PACKAGES

echo "Done"
